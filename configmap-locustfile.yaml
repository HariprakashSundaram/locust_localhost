# configmap-locustfile.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: locustfile
  namespace: locust
data:
  locustfile.py: |
    """
    Main Locustfile - Multi-site Load Testing
    Dynamically imports test classes from scripts folder
    """

    import sys
    import os

    # Add scripts folder to Python path
    scripts_dir = os.path.join(os.path.dirname(__file__), 'scripts')
    if os.path.exists(scripts_dir):
        sys.path.insert(0, scripts_dir)

    # Import test classes from individual scripts
    from google_load_test import GoogleLoadTest
    from demoblaze_load_test import DemoBlazeLoadTest
    from opencart_load_test import OpenCartLoadTest

    __all__ = [
        'GoogleLoadTest',
        'DemoBlazeLoadTest', 
        'OpenCartLoadTest'
    ]

  google_load_test.py: |
    from locust import HttpUser, task, between

    class GoogleLoadTest(HttpUser):
        """Load test for Google Search"""
        wait_time = between(1, 3)
        
        def on_start(self):
            """Execute on user start"""
            pass
        
        @task(2)
        def search_query(self):
            """Simulate Google search queries"""
            self.client.get("/search?q=locust+performance+testing")
        
        @task(1)
        def homepage(self):
            """Visit Google homepage"""
            self.client.get("/")
        
        @task(1)
        def images_search(self):
            """Search images on Google"""
            self.client.get("/search?q=python&tbm=isch")

  demoblaze_load_test.py: |
    from locust import HttpUser, task, between

    class DemoBlazeLoadTest(HttpUser):
        """Load test for DemoBlaze - E-commerce Demo Site"""
        wait_time = between(2, 5)
        
        def on_start(self):
            """Execute on user start"""
            pass
        
        @task(3)
        def browse_products(self):
            """Browse product categories"""
            categories = [1, 2, 3, 4]  # Electronics, Laptops, Monitors, Phones
            self.client.get(f"/product/{categories[0]}")
        
        @task(2)
        def view_product_detail(self):
            """View individual product details"""
            self.client.get("/prod?idp_=1")
        
        @task(1)
        def add_to_cart(self):
            """Simulate adding to cart"""
            self.client.post("/", {"cart_product": "1"})
        
        @task(1)
        def view_cart(self):
            """View shopping cart"""
            self.client.get("/cart.html")
        
        @task(2)
        def homepage(self):
            """Visit homepage"""
            self.client.get("/")

  opencart_load_test.py: |
    from locust import HttpUser, task, between

    class OpenCartLoadTest(HttpUser):
        """Load test for OpenCart - Open Source E-commerce Platform"""
        wait_time = between(1, 4)
        
        def on_start(self):
            """Execute on user start"""
            pass
        
        @task(3)
        def browse_categories(self):
            """Browse product categories"""
            self.client.get("/index.php?route=product/category&path=20")
        
        @task(2)
        def search_products(self):
            """Search for products"""
            self.client.get("/index.php?route=product/search&search=laptop")
        
        @task(2)
        def product_details(self):
            """View product detail page"""
            self.client.get("/index.php?route=product/product&product_id=28")
        
        @task(1)
        def add_to_cart(self):
            """Add product to shopping cart"""
            self.client.post("/index.php?route=checkout/cart/add", 
                            {"product_id": 28, "quantity": 1})
        
        @task(1)
        def view_cart(self):
            """View shopping cart"""
            self.client.get("/index.php?route=checkout/cart")
        
        @task(1)
        def checkout(self):
            """Proceed to checkout"""
            self.client.get("/index.php?route=checkout/checkout")
        
        @task(2)
        def homepage(self):
            """Visit store homepage"""
            self.client.get("/")

